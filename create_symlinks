#!/bin/bash
# This script creates symlinks of the various personal scripts I keep in my tampakrap/scripts.git repository

. /etc/init.d/functions.sh

if [[ $(whoami) != "root" ]]; then
	eerror "Must be run as root, terminating"
	exit 1
fi

USER="tampakrap"

function _update() {
	local DESTINATIONS="/usr/local/sbin /usr/local/bin"

	einfo "Update symlinks for ${HOSTNAME}"

	for DESTINATION in ${DESTINATIONS}; do
		if [[ ${DESTINATION} == "/usr/local/sbin" ]]; then
			SCRIPTS=${SBIN}
		else
			SCRIPTS=${BIN}
		fi
		for script in ${SCRIPTS}; do
			[[ -L ${DESTINATION}/${script} ]] || \
			( ln -s ${REPOSITORY}/${script} ${DESTINATION} && \
			einfo "New script ${script} installed in ${DESTINATION}" )
		done
	done

	# /etc/hosts.d
	[[ -L /etc/hosts.d ]] || ( ln -s ${REPOSITORY}/hosts.d /etc && einfo "Installed hosts.d" )

	# homedir
	if [[ ${HOMEDIR} == 1 ]]; then
		REPOSITORY="/home/$USER/Source_Code/raekwon/scripts"
		[[ -L /home/$USER/.gitconfig ]] || \
			( su -c "ln -s ${REPOSITORY}/gitconfig ~/.gitconfig" $USER && einfo "Installed .gitconfig" )
		[[ -L /home/$USER/.ssh/config ]] || \
			( su -c "ln -s ${REPOSITORY}/sshconfig ~/.ssh/config" $USER && einfo "Installed .ssh/config" )
	else
		REPOSITORY="/var/repos/scripts"
	fi

	einfo "Done"
}

case $HOSTNAME in
	canibus)
		SBIN="create_symlinks emerge-tmpfs host-update update"
		BIN="create_repolinks git packagelist wakeonlan"
		HOMEDIR=1
		;;

	virtuoso)
		SBIN="create_symlinks emerge-tmpfs host-update update"
		BIN="create_repolinks music-sync git packagelist ssh wakeonlan"
		HOMEDIR=1
		;;

	madlib)
		SBIN="create_symlinks emerge-tmpfs host-update update"
		BIN="wakeonlan"
		;;

	eyedea)
		SBIN="create_symlinks emerge-tmpfs host-update update-notifier"
		BIN="wakeonlan"
		;;

	evidence)
		SBIN="create_symlinks emerge-tmpfs host-update update-notifier"
		BIN="wakeonlan"
		;;

	evidence)
		SBIN="create_symlinks emerge-tmpfs host-update update-notifier"
		BIN="wakeonlan"
		;;

# TODO: Intergrate the following hosts
#	raekwon)
#		SBIN=""
#		BIN=""
#		;;

#	xzibit)
#		SBIN=""
#		BIN=""
#		HOMEDIR=1
#		;;

	*)
		ewarn "${HOSTNAME} not found, terminating"
		exit 1
esac

_update
